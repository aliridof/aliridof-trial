<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inspect Element</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#ffffff;
  --bg-secondary:#f5f5f5;
  --border:#e0e0e0;
  --text:#000000;
  --text-secondary:#666666;
  --accent:#000000;
  --hover:#f0f0f0;
}
[data-theme="dark"]{
  --bg:#1a1a1a;
  --bg-secondary:#2a2a2a;
  --border:#3a3a3a;
  --text:#ffffff;
  --text-secondary:#999999;
  --accent:#ffffff;
  --hover:#333333;
}
body{
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg);
  color:var(--text);
  height:100vh;
  overflow:hidden;
}
.app{display:flex;height:100vh}

/* Header */
.header{
  position:absolute;
  top:0;
  left:0;
  right:0;
  height:48px;
  background:var(--bg);
  border-bottom:1px solid var(--border);
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 16px;
  z-index:100;
}
.tabs{display:flex;gap:4px}
.tab{
  padding:6px 12px;
  background:transparent;
  border:1px solid transparent;
  color:var(--text-secondary);
  cursor:pointer;
  font-size:13px;
  transition:all .15s;
}
.tab:hover{background:var(--hover)}
.tab.active{
  color:var(--text);
  border-color:var(--border);
  background:var(--bg-secondary);
}
.controls{display:flex;gap:8px;align-items:center}
.btn{
  padding:6px 12px;
  background:var(--accent);
  color:var(--bg);
  border:1px solid var(--accent);
  cursor:pointer;
  font-size:13px;
  transition:all .15s;
}
.btn:hover{opacity:.8}
.btn.outline{
  background:transparent;
  color:var(--accent);
}
.theme-toggle{
  width:20px;
  height:20px;
  cursor:pointer;
  border:none;
  background:transparent;
  color:var(--text);
  font-size:18px;
}

/* Layout */
.left{
  width:40%;
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  margin-top:48px;
}
.right{
  flex:1;
  display:flex;
  flex-direction:column;
  margin-top:48px;
}

/* Chat */
.chat{display:flex;flex-direction:column;height:100%}
.messages{flex:1;overflow-y:auto;padding:16px}
.msg{
  margin-bottom:12px;
  padding:12px;
  background:var(--bg-secondary);
  border-left:2px solid var(--accent);
  font-size:13px;
  line-height:1.5;
}
.msg pre{
  margin-top:8px;
  padding:8px;
  background:var(--bg);
  border:1px solid var(--border);
  font-size:12px;
  overflow-x:auto;
  white-space:pre-wrap;
}
.input-area{
  border-top:1px solid var(--border);
  padding:12px;
  display:flex;
  gap:8px;
}
.input-area textarea{
  flex:1;
  padding:8px;
  background:var(--bg-secondary);
  border:1px solid var(--border);
  color:var(--text);
  font-family:inherit;
  font-size:13px;
  resize:none;
  min-height:80px;
}

/* Content Area */
.content{flex:1;position:relative;overflow:hidden}
.view{display:none;height:100%}
.view.active{display:flex;flex-direction:column}

/* Code View */
.code-view{padding:16px}
.code-view textarea{
  width:100%;
  height:calc(100vh - 140px);
  padding:12px;
  background:var(--bg-secondary);
  border:1px solid var(--border);
  color:var(--text);
  font-family:monospace;
  font-size:13px;
  resize:none;
}
.code-actions{margin-top:8px;display:flex;gap:8px}

/* URL View */
.url-bar{
  padding:12px;
  background:var(--bg-secondary);
  border-bottom:1px solid var(--border);
  display:flex;
  gap:8px;
}
.url-bar input{
  flex:1;
  padding:6px 12px;
  background:var(--bg);
  border:1px solid var(--border);
  color:var(--text);
  font-size:13px;
}

/* Preview */
.preview-wrap{flex:1;position:relative;background:var(--bg)}
.preview-frame{
  width:100%;
  height:100%;
  border:none;
  background:#fff;
}
.overlay{
  position:absolute;
  top:0;
  left:0;
  right:0;
  bottom:0;
  display:none;
  cursor:crosshair;
  background:rgba(0,0,0,.01);
}
.overlay.active{display:block}
.badge{
  position:absolute;
  bottom:12px;
  right:12px;
  padding:4px 8px;
  background:var(--accent);
  color:var(--bg);
  font-size:11px;
  display:none;
}
.badge.active{display:block}

/* Scrollbar */
::-webkit-scrollbar{width:8px;height:8px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--border)}
::-webkit-scrollbar-thumb:hover{background:var(--text-secondary)}

/* Responsive */
@media(max-width:768px){
  .app{flex-direction:column}
  .left{width:100%;height:50%;border-right:none;border-bottom:1px solid var(--border)}
  .right{height:50%}
}
</style>
</head>
<body data-theme="light">

<!-- Header -->
<div class="header">
  <div class="tabs">
    <button class="tab active" data-view="preview">Preview</button>
    <button class="tab" data-view="code">Code</button>
    <button class="tab" data-view="url">URL</button>
  </div>
  <div class="controls">
    <button class="btn outline" id="inspect">+ Inspect</button>
    <button class="theme-toggle" id="theme">‚óè</button>
  </div>
</div>

<!-- Main Layout -->
<div class="app">
  <!-- Left: Chat -->
  <div class="left">
    <div class="chat">
      <div class="messages" id="msgs">
        <div class="msg">
          <strong>Welcome</strong>
          <p>1. Switch to Code/URL tab to load content</p>
          <p>2. Click "+ Inspect" to select elements</p>
          <p>3. Click elements to copy info to chat</p>
          <p>4. Add notes and press Send</p>
        </div>
      </div>
      <div class="input-area">
        <textarea id="input" placeholder="Type your notes..."></textarea>
        <button class="btn" id="send">Send</button>
      </div>
    </div>
  </div>

  <!-- Right: Content -->
  <div class="right">
    <div class="content">
      <!-- Preview View -->
      <div class="view active" id="preview-view">
        <div class="preview-wrap">
          <iframe id="frame" class="preview-frame"></iframe>
          <div class="overlay" id="overlay"></div>
          <div class="badge" id="badge">INSPECT ON</div>
        </div>
      </div>

      <!-- Code View -->
      <div class="view" id="code-view">
        <div class="code-view">
          <textarea id="code" placeholder="Paste HTML, CSS, and JavaScript here..."></textarea>
          <div class="code-actions">
            <button class="btn" id="render">Render</button>
            <button class="btn outline" id="clear">Clear</button>
          </div>
        </div>
      </div>

      <!-- URL View -->
      <div class="view" id="url-view">
        <div class="url-bar">
          <input type="url" id="url" placeholder="https://example.com">
          <button class="btn" id="go">Go</button>
        </div>
        <div class="preview-wrap">
          <iframe id="urlFrame" class="preview-frame"></iframe>
          <div class="overlay" id="urlOverlay"></div>
          <div class="badge" id="urlBadge">INSPECT ON</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// State
let state={
  view:'preview',
  inspect:false,
  frame:null,
  overlay:null,
  badge:null
};

// Elements
const $=(id)=>document.getElementById(id);
const $$=(s)=>document.querySelectorAll(s);

const views=$$('.view');
const tabs=$$('.tab');
const msgs=$('msgs');
const input=$('input');
const frame=$('frame');
const urlFrame=$('urlFrame');
const overlay=$('overlay');
const urlOverlay=$('urlOverlay');
const badge=$('badge');
const urlBadge=$('urlBadge');

// Set active frame/overlay based on view
function setActiveView(view){
  if(view==='url'){
    state.frame=urlFrame;
    state.overlay=urlOverlay;
    state.badge=urlBadge;
  }else{
    state.frame=frame;
    state.overlay=overlay;
    state.badge=badge;
  }
}

// Tab Switch
tabs.forEach(tab=>{
  tab.onclick=()=>{
    const view=tab.dataset.view;
    tabs.forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    views.forEach(v=>v.classList.remove('active'));
    $(`${view}-view`).classList.add('active');
    state.view=view;
    setActiveView(view);
    
    // Turn off inspect when switching views
    if(state.inspect){
      toggleInspect();
    }
  };
});

// Theme Toggle
$('theme').onclick=()=>{
  const theme=document.body.dataset.theme==='light'?'dark':'light';
  document.body.dataset.theme=theme;
  $('theme').textContent=theme==='light'?'‚óè':'‚óã';
};

// Render Code
$('render').onclick=()=>{
  const code=$('code').value.trim();
  if(!code)return msg('‚ö†Ô∏è No code to render');
  frame.srcdoc=code;
  tabs[0].click();
  msg('‚úì Rendered successfully');
};

// Clear Code
$('clear').onclick=()=>{
  if(confirm('Clear code?'))$('code').value='';
};

// Load URL
$('go').onclick=()=>{
  const url=$('url').value.trim();
  if(!url)return msg('‚ö†Ô∏è Enter a URL');
  
  // Validate URL
  try{
    new URL(url);
  }catch(e){
    return msg('‚ö†Ô∏è Invalid URL format');
  }
  
  // Try to load
  try{
    urlFrame.src=url;
    msg(`‚Üí Loading: ${url}`);
    
    // Check if loaded
    urlFrame.onload=()=>msg('‚úì URL loaded');
    urlFrame.onerror=()=>msg('‚ö†Ô∏è Failed to load. Site may block iframes.');
    
    // Timeout check
    setTimeout(()=>{
      try{
        const doc=urlFrame.contentDocument||urlFrame.contentWindow.document;
        if(!doc.body||!doc.body.innerHTML){
          msg('‚ö†Ô∏è Cannot access content. CORS restriction or blocked iframe.');
        }
      }catch(e){
        msg('‚ö†Ô∏è Cannot access content. Try a different URL or use Code tab.');
      }
    },3000);
  }catch(e){
    msg('‚ö†Ô∏è Error loading URL');
  }
};

// Inspect Toggle
$('inspect').onclick=toggleInspect;

function toggleInspect(){
  state.inspect=!state.inspect;
  const btn=$('inspect');
  
  if(state.inspect){
    btn.textContent='‚úì Inspect';
    btn.classList.remove('outline');
    state.overlay.classList.add('active');
    state.badge.classList.add('active');
    enableInspect();
  }else{
    btn.textContent='+ Inspect';
    btn.classList.add('outline');
    state.overlay.classList.remove('active');
    state.badge.classList.remove('active');
    disableInspect();
  }
}

// Inspect Handlers
let hovered=null;

function enableInspect(){
  state.overlay.onmousemove=handleMove;
  state.overlay.onclick=handleClick;
}

function disableInspect(){
  state.overlay.onmousemove=null;
  state.overlay.onclick=null;
  clearHighlight();
}

function handleMove(e){
  try{
    const doc=state.frame.contentDocument||state.frame.contentWindow.document;
    const rect=state.frame.getBoundingClientRect();
    const x=e.clientX-rect.left;
    const y=e.clientY-rect.top;
    const el=doc.elementFromPoint(x,y);
    
    if(el&&el!==hovered){
      if(hovered)hovered.style.outline='';
      el.style.outline='2px solid '+getComputedStyle(document.body).getPropertyValue('--accent');
      hovered=el;
    }
  }catch(e){
    msg('‚ö†Ô∏è Cannot inspect. Try rendering code instead of loading external URLs.');
    toggleInspect();
  }
}

function handleClick(e){
  try{
    const doc=state.frame.contentDocument||state.frame.contentWindow.document;
    const rect=state.frame.getBoundingClientRect();
    const x=e.clientX-rect.left;
    const y=e.clientY-rect.top;
    const el=doc.elementFromPoint(x,y);
    
    if(el){
      clearHighlight();
      el.style.outline='2px solid '+getComputedStyle(document.body).getPropertyValue('--accent');
      el.style.outlineOffset='2px';
      
      const info=extract(el);
      copyToChat(info);
    }
  }catch(e){
    msg('‚ö†Ô∏è Cannot select element');
  }
}

function clearHighlight(){
  try{
    const doc=state.frame.contentDocument||state.frame.contentWindow.document;
    const all=doc.querySelectorAll('*');
    all.forEach(el=>el.style.outline='');
  }catch(e){}
}

// Extract Element Info
function extract(el){
  const tag=el.tagName.toLowerCase();
  const id=el.id?` id="${el.id}"`:'';
  const cls=el.className?` class="${el.className}"`:'';
  const txt=el.textContent.trim().substring(0,60);
  const html=el.outerHTML.substring(0,150);
  
  return{tag,id,cls,txt,html};
}

// Copy to Chat
function copyToChat(info){
  const text=`üìç Selected Element:

<${info.tag}${info.id}${info.cls}>
${info.txt?info.txt:'(no text)'}

HTML Preview:
${info.html}${info.html.length>=150?'...':''}

What changes would you like?`;
  
  input.value=text;
  input.focus();
  msg('‚úì Element info copied to chat');
}

// Send Message
$('send').onclick=send;
input.onkeydown=e=>{
  if(e.key==='Enter'&&e.ctrlKey)send();
};

function send(){
  const val=input.value.trim();
  if(!val)return;
  
  const div=document.createElement('div');
  div.className='msg';
  div.innerHTML=`<strong>You:</strong><pre>${esc(val)}</pre>`;
  msgs.appendChild(div);
  msgs.scrollTop=msgs.scrollHeight;
  
  input.value='';
  msg('‚úì Message saved');
}

// Add System Message
function msg(text){
  const div=document.createElement('div');
  div.className='msg';
  div.innerHTML=`<strong>System:</strong><p>${text}</p>`;
  msgs.appendChild(div);
  msgs.scrollTop=msgs.scrollHeight;
}

// Escape HTML
function esc(str){
  const div=document.createElement('div');
  div.textContent=str;
  return div.innerHTML;
}

// Initialize
setActiveView('preview');
</script>

</body>
</html>
